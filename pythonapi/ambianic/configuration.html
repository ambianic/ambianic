<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>ambianic.configuration API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ambianic.configuration</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import logging
import os
from argparse import ArgumentParser

import importlib_metadata as metadata
from dynaconf import Dynaconf, loaders

log = logging.getLogger()

parser = ArgumentParser()
parser.add_argument(&#34;-c&#34;, &#34;--config&#34;, help=&#34;Specify config YAML file location.&#34;)
parser.add_argument(
    &#34;-p&#34;,
    &#34;--peerfile&#34;,
    help=&#34;Specify file location with peerfetch values such as current peerid.&#34;,
)

args, unknown = parser.parse_known_args()

# default path locations
DEFAULT_WORK_DIR: str = &#34;/workspace&#34;
DEFAULT_DATA_DIR: str = &#34;./data&#34;

CONFIG_FILE_PATH: str = args.config or &#34;config.yaml&#34;
PEER_FILE_PATH: str = args.peerfile or &#34;.peerjsrc&#34;
SECRETS_FILE_PATH: str = &#34;secrets.yaml&#34;

CONFIG_DEFAULTS_FILE_PATH: str = &#34;config.defaults.yaml&#34;

# actual local file locations
__config_file: str = None
__secrets_file: str = None

# package version
__version__: str = metadata.version(&#34;ambianic-edge&#34;)

# refernce to system global config instance
__config: Dynaconf = &#34;Not Initialized Yet!&#34;


def get_root_config() -&gt; Dynaconf:
    return __config


def get_config_defaults_file() -&gt; str:
    return CONFIG_DEFAULTS_FILE_PATH


def get_config_file() -&gt; str:
    &#34;&#34;&#34;Return path to main config file for this instance.
    This is typically the file with baseline configuration settings
    across a fleet of similar devices.
    &#34;&#34;&#34;
    return __config_file


def get_local_config_file() -&gt; str:
    &#34;&#34;&#34;Return path to local custom config file. E.g. config.local.yaml.
    This is the file where config changes via API calls are saved.
    This is also the file where manual local changes can be applied and saved to override values from other config files.&#34;&#34;&#34;
    (cfg_file_head, cfg_file_ext) = os.path.splitext(get_config_file())
    local_file_path = cfg_file_head + &#34;.local&#34; + cfg_file_ext
    return local_file_path


def get_peerid_file():
    &#34;&#34;&#34;Return path to the file where peerfetch Peer ID for this device is stored.&#34;&#34;&#34;
    return __peer_file


def get_secrets_file() -&gt; str:
    if __secrets_file:
        return __secrets_file
    return os.path.join(get_work_dir(), SECRETS_FILE_PATH)


def get_all_config_files():
    conf_files = os.environ.get(&#34;AMBIANIC_CONFIG_FILES&#34;)
    if conf_files:
        file_list = conf_files.split(&#34;,&#34;)
        file_list = list(map(lambda s: s.strip(), file_list))
        return file_list


def init_config() -&gt; Dynaconf:
    log.debug(&#34;Configuration: begin init_config()&#34;)
    global __config
    conf_files = os.environ.get(&#34;AMBIANIC_CONFIG_FILES&#34;, None)
    if conf_files is None:
        conf_files = &#34;,&#34;.join(
            [
                get_config_defaults_file(),
                get_secrets_file(),
                get_peerid_file(),
                get_config_file(),
            ]
        )
    os.environ[&#34;AMBIANIC_CONFIG_FILES&#34;] = conf_files
    os.environ[&#34;SETTINGS_FILE_FOR_DYNACONF&#34;] = conf_files
    log.info(f&#34;Loading config settings from: {conf_files}&#34;)
    __config = Dynaconf(
        # settings_files read from SETTINGS_FILE_FOR_DYNACONF
        environments=False,
    )
    log.debug(f&#34;Config settings: {get_root_config().as_dict()}&#34;)
    return __config


def reload_config() -&gt; Dynaconf:
    &#34;&#34;&#34;Reloads settings with latest config file updates.&#34;&#34;&#34;
    __config.reload()
    log.info(&#34;Configuration: reloaded.&#34;)
    log.debug(f&#34;Config settings: {get_root_config().as_dict()}&#34;)


def save_config():
    &#34;&#34;&#34;Persist configuration settings to local config file.&#34;&#34;&#34;
    # ref: https://dynaconf.readthedocs.io/en/docs_223/guides/advanced_usage.html#exporting
    # ref: https://dynaconf.readthedocs.io/en/docs_223/reference/dynaconf.loaders.html#module-dynaconf.loaders.yaml_loader
    file_to_save = os.environ.get(&#34;AMBIANIC_SAVE_CONFIG_TO&#34;, None)
    if not file_to_save:
        file_to_save = get_local_config_file()
    root_config = get_root_config()
    data = root_config.as_dict()
    log.info(f&#34;Saving config settings to: {file_to_save}&#34;)
    loaders.write(file_to_save, data)


def get_work_dir() -&gt; str:
    &#34;&#34;&#34;Retrieve the ambianic working directory&#34;&#34;&#34;
    env_work_dir = os.environ.get(&#34;AMBIANIC_DIR&#34;, os.getcwd())
    if not env_work_dir:
        env_work_dir = DEFAULT_WORK_DIR
    return env_work_dir


__config_file = os.path.join(get_work_dir(), CONFIG_FILE_PATH)
__peer_file = os.path.join(get_work_dir(), PEER_FILE_PATH)


# initial config init
init_config()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="ambianic.configuration.get_all_config_files"><code class="name flex">
<span>def <span class="ident">get_all_config_files</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_all_config_files():
    conf_files = os.environ.get(&#34;AMBIANIC_CONFIG_FILES&#34;)
    if conf_files:
        file_list = conf_files.split(&#34;,&#34;)
        file_list = list(map(lambda s: s.strip(), file_list))
        return file_list</code></pre>
</details>
</dd>
<dt id="ambianic.configuration.get_config_defaults_file"><code class="name flex">
<span>def <span class="ident">get_config_defaults_file</span></span>(<span>) ‑> str</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_config_defaults_file() -&gt; str:
    return CONFIG_DEFAULTS_FILE_PATH</code></pre>
</details>
</dd>
<dt id="ambianic.configuration.get_config_file"><code class="name flex">
<span>def <span class="ident">get_config_file</span></span>(<span>) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Return path to main config file for this instance.
This is typically the file with baseline configuration settings
across a fleet of similar devices.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_config_file() -&gt; str:
    &#34;&#34;&#34;Return path to main config file for this instance.
    This is typically the file with baseline configuration settings
    across a fleet of similar devices.
    &#34;&#34;&#34;
    return __config_file</code></pre>
</details>
</dd>
<dt id="ambianic.configuration.get_local_config_file"><code class="name flex">
<span>def <span class="ident">get_local_config_file</span></span>(<span>) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Return path to local custom config file. E.g. config.local.yaml.
This is the file where config changes via API calls are saved.
This is also the file where manual local changes can be applied and saved to override values from other config files.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_local_config_file() -&gt; str:
    &#34;&#34;&#34;Return path to local custom config file. E.g. config.local.yaml.
    This is the file where config changes via API calls are saved.
    This is also the file where manual local changes can be applied and saved to override values from other config files.&#34;&#34;&#34;
    (cfg_file_head, cfg_file_ext) = os.path.splitext(get_config_file())
    local_file_path = cfg_file_head + &#34;.local&#34; + cfg_file_ext
    return local_file_path</code></pre>
</details>
</dd>
<dt id="ambianic.configuration.get_peerid_file"><code class="name flex">
<span>def <span class="ident">get_peerid_file</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Return path to the file where peerfetch Peer ID for this device is stored.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_peerid_file():
    &#34;&#34;&#34;Return path to the file where peerfetch Peer ID for this device is stored.&#34;&#34;&#34;
    return __peer_file</code></pre>
</details>
</dd>
<dt id="ambianic.configuration.get_root_config"><code class="name flex">
<span>def <span class="ident">get_root_config</span></span>(<span>) ‑> dynaconf.base.LazySettings</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_root_config() -&gt; Dynaconf:
    return __config</code></pre>
</details>
</dd>
<dt id="ambianic.configuration.get_secrets_file"><code class="name flex">
<span>def <span class="ident">get_secrets_file</span></span>(<span>) ‑> str</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_secrets_file() -&gt; str:
    if __secrets_file:
        return __secrets_file
    return os.path.join(get_work_dir(), SECRETS_FILE_PATH)</code></pre>
</details>
</dd>
<dt id="ambianic.configuration.get_work_dir"><code class="name flex">
<span>def <span class="ident">get_work_dir</span></span>(<span>) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Retrieve the ambianic working directory</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_work_dir() -&gt; str:
    &#34;&#34;&#34;Retrieve the ambianic working directory&#34;&#34;&#34;
    env_work_dir = os.environ.get(&#34;AMBIANIC_DIR&#34;, os.getcwd())
    if not env_work_dir:
        env_work_dir = DEFAULT_WORK_DIR
    return env_work_dir</code></pre>
</details>
</dd>
<dt id="ambianic.configuration.init_config"><code class="name flex">
<span>def <span class="ident">init_config</span></span>(<span>) ‑> dynaconf.base.LazySettings</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def init_config() -&gt; Dynaconf:
    log.debug(&#34;Configuration: begin init_config()&#34;)
    global __config
    conf_files = os.environ.get(&#34;AMBIANIC_CONFIG_FILES&#34;, None)
    if conf_files is None:
        conf_files = &#34;,&#34;.join(
            [
                get_config_defaults_file(),
                get_secrets_file(),
                get_peerid_file(),
                get_config_file(),
            ]
        )
    os.environ[&#34;AMBIANIC_CONFIG_FILES&#34;] = conf_files
    os.environ[&#34;SETTINGS_FILE_FOR_DYNACONF&#34;] = conf_files
    log.info(f&#34;Loading config settings from: {conf_files}&#34;)
    __config = Dynaconf(
        # settings_files read from SETTINGS_FILE_FOR_DYNACONF
        environments=False,
    )
    log.debug(f&#34;Config settings: {get_root_config().as_dict()}&#34;)
    return __config</code></pre>
</details>
</dd>
<dt id="ambianic.configuration.reload_config"><code class="name flex">
<span>def <span class="ident">reload_config</span></span>(<span>) ‑> dynaconf.base.LazySettings</span>
</code></dt>
<dd>
<div class="desc"><p>Reloads settings with latest config file updates.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def reload_config() -&gt; Dynaconf:
    &#34;&#34;&#34;Reloads settings with latest config file updates.&#34;&#34;&#34;
    __config.reload()
    log.info(&#34;Configuration: reloaded.&#34;)
    log.debug(f&#34;Config settings: {get_root_config().as_dict()}&#34;)</code></pre>
</details>
</dd>
<dt id="ambianic.configuration.save_config"><code class="name flex">
<span>def <span class="ident">save_config</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Persist configuration settings to local config file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_config():
    &#34;&#34;&#34;Persist configuration settings to local config file.&#34;&#34;&#34;
    # ref: https://dynaconf.readthedocs.io/en/docs_223/guides/advanced_usage.html#exporting
    # ref: https://dynaconf.readthedocs.io/en/docs_223/reference/dynaconf.loaders.html#module-dynaconf.loaders.yaml_loader
    file_to_save = os.environ.get(&#34;AMBIANIC_SAVE_CONFIG_TO&#34;, None)
    if not file_to_save:
        file_to_save = get_local_config_file()
    root_config = get_root_config()
    data = root_config.as_dict()
    log.info(f&#34;Saving config settings to: {file_to_save}&#34;)
    loaders.write(file_to_save, data)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ambianic" href="index.html">ambianic</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="ambianic.configuration.get_all_config_files" href="#ambianic.configuration.get_all_config_files">get_all_config_files</a></code></li>
<li><code><a title="ambianic.configuration.get_config_defaults_file" href="#ambianic.configuration.get_config_defaults_file">get_config_defaults_file</a></code></li>
<li><code><a title="ambianic.configuration.get_config_file" href="#ambianic.configuration.get_config_file">get_config_file</a></code></li>
<li><code><a title="ambianic.configuration.get_local_config_file" href="#ambianic.configuration.get_local_config_file">get_local_config_file</a></code></li>
<li><code><a title="ambianic.configuration.get_peerid_file" href="#ambianic.configuration.get_peerid_file">get_peerid_file</a></code></li>
<li><code><a title="ambianic.configuration.get_root_config" href="#ambianic.configuration.get_root_config">get_root_config</a></code></li>
<li><code><a title="ambianic.configuration.get_secrets_file" href="#ambianic.configuration.get_secrets_file">get_secrets_file</a></code></li>
<li><code><a title="ambianic.configuration.get_work_dir" href="#ambianic.configuration.get_work_dir">get_work_dir</a></code></li>
<li><code><a title="ambianic.configuration.init_config" href="#ambianic.configuration.init_config">init_config</a></code></li>
<li><code><a title="ambianic.configuration.reload_config" href="#ambianic.configuration.reload_config">reload_config</a></code></li>
<li><code><a title="ambianic.configuration.save_config" href="#ambianic.configuration.save_config">save_config</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>